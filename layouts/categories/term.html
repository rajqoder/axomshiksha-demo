{{ define "main" }}
<div class="max-w-7xl mx-auto p-6">
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Main Content -->
        <div class="lg:w-2/3">
            <div class="mb-8">
                {{ partial "breadcrumbs.html" . }}
            </div>

            <div class="space-y-6">
                {{/* Group pages by their Section (Class) */}}
                {{ $sections := slice }}
                {{ range .Pages }}
                {{ $section := .FirstSection }}
                {{ if and $section (not (in $sections $section)) }}
                {{ $sections = $sections | append $section }}
                {{ end }}
                {{ end }}

                {{/* Display all Sections in a single grid */}}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {{ range sort $sections "Title" "asc" }}
                    <div class="card p-6 hover:shadow-lg transition-shadow">
                        <h2 class="text-xl font-bold text-main mb-2">
                            <a href="{{ .RelPermalink }}" class="hover:text-blue-600 transition-colors">{{ .Title }}</a>
                        </h2>
                        {{ $tagData := index (index $.Site.Data "sub-category") ( .Title | urlize ) }}
                        <p class="text-muted-foreground text-sm mb-3">
                            {{ if $tagData }}
                            {{ $tagData.description | truncate 100 }}
                            {{ else }}
                            {{ .Description | truncate 100 }}
                            {{ end }}
                        </p>
                        <a href="{{ .RelPermalink }}"
                            class="inline-block bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded transition-colors">
                            Explore {{ .Title }}
                        </a>
                    </div>
                    {{ end }}
                </div>
            </div>


        </div>

        <!-- Sidebar -->
        <aside class="lg:w-1/3">
            <div class="sticky top-24 space-y-8">
                <!-- About Category Widget -->
                {{ $categoryData := index .Site.Data.categories ( .Title | urlize ) }}
                {{ if or $categoryData .Description }}
                <div class="card">
                    <h3 class="card-title mb-4">{{ .Title | humanize }}</h3>
                    <p class="text-muted-foreground">
                        {{ if $categoryData }}
                        {{ $categoryData.description }}
                        {{ else }}
                        {{ .Description }}
                        {{ end }}
                    </p>
                </div>
                {{ end }}

                <!-- Categories Widget -->
                <div class="card">
                    <h3 class="card-title mb-4">Other Categories</h3>
                    <div class="flex flex-col gap-2">
                        {{ $currentCategory := .Title | urlize }}
                        {{ $count := 0 }}
                        {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
                        {{ if and (ne ($name | urlize) $currentCategory) (lt $count 3) }}
                        <a href="{{ "/categories/" | relLangURL }}{{ $name | urlize }}"
                            class="flex items-center justify-between text-main hover:text-blue-600 transition-colors">
                            <span>{{ $name | humanize }}</span>
                            <span
                                class="text-sm font-medium text-gray-700 bg-gray-200 dark:text-gray-300 dark:bg-gray-800 px-2.5 py-0.5 rounded-full">{{
                                $taxonomy.Count }}</span>
                        </a>
                        {{ $count = add $count 1 }}
                        {{ end }}
                        {{ end }}
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-800">
                        <a href="/categories/"
                            class="text-sm font-medium text-blue-600 hover:text-blue-700 hover:underline">
                            View All â†’
                        </a>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>
{{ end }}